# Migration `20201205141104-init`

This migration has been generated by EGOIST at 12/5/2020, 10:11:04 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "users" (
"id" SERIAL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,
    "name" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "google_user_id" TEXT,
    "github_user_id" TEXT,
    "avatar" TEXT,

    PRIMARY KEY ("id")
)

CREATE TABLE "blogs" (
"id" SERIAL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,
    "user_id" INTEGER NOT NULL,
    "default_for_user_id" INTEGER,
    "name" TEXT NOT NULL,
    "slug" TEXT NOT NULL,
    "introduction" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "posts" (
"id" SERIAL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,
    "title" TEXT NOT NULL,
    "content" TEXT NOT NULL,
    "slug" TEXT NOT NULL,
    "readable_slug" TEXT NOT NULL,
    "draft" BOOLEAN,
    "blog_id" INTEGER NOT NULL,
    "likes_count" INTEGER NOT NULL DEFAULT 0,
    "cover" TEXT,
    "cover_alt" TEXT,

    PRIMARY KEY ("id")
)

CREATE TABLE "likes" (
"id" SERIAL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "post_id" INTEGER NOT NULL,
    "user_id" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "tags" (
"id" SERIAL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "name" TEXT NOT NULL,
    "slug" TEXT NOT NULL,
    "blog_id" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_post_tags" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "users.email_unique" ON "users"("email")

CREATE UNIQUE INDEX "users.google_user_id_unique" ON "users"("google_user_id")

CREATE UNIQUE INDEX "users.github_user_id_unique" ON "users"("github_user_id")

CREATE UNIQUE INDEX "blogs.slug_unique" ON "blogs"("slug")

CREATE UNIQUE INDEX "blogs_default_for_user_id_unique" ON "blogs"("default_for_user_id")

CREATE UNIQUE INDEX "posts.slug_unique" ON "posts"("slug")

CREATE UNIQUE INDEX "_post_tags_AB_unique" ON "_post_tags"("A", "B")

CREATE INDEX "_post_tags_B_index" ON "_post_tags"("B")

ALTER TABLE "blogs" ADD FOREIGN KEY("user_id")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "blogs" ADD FOREIGN KEY("default_for_user_id")REFERENCES "users"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "posts" ADD FOREIGN KEY("blog_id")REFERENCES "blogs"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "likes" ADD FOREIGN KEY("post_id")REFERENCES "posts"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "likes" ADD FOREIGN KEY("user_id")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "tags" ADD FOREIGN KEY("blog_id")REFERENCES "blogs"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_post_tags" ADD FOREIGN KEY("A")REFERENCES "posts"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_post_tags" ADD FOREIGN KEY("B")REFERENCES "tags"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201205141104-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,87 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgres"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id           Int      @id @default(autoincrement())
+  createdAt    DateTime @default(now()) @map("created_at")
+  updatedAt    DateTime @updatedAt @map("updated_at")
+  name         String
+  email        String   @unique
+  googleUserId String?  @unique @map("google_user_id")
+  githubUserId String?  @unique @map("github_user_id")
+  avatar       String?
+  blogs        Blog[]   @relation("user_blogs")
+  likes        Like[]   @relation("user_likes")
+  defaultBlog  Blog?    @relation("user_default_blog")
+
+  @@map("users")
+}
+
+model Blog {
+  id               Int      @id @default(autoincrement())
+  createdAt        DateTime @default(now()) @map("created_at")
+  updatedAt        DateTime @updatedAt @map("updated_at")
+  user             User     @relation("user_blogs", fields: [userId], references: [id])
+  userId           Int      @map("user_id")
+  defaultForUser   User?    @relation("user_default_blog", fields: [defaultForUserId], references: [id])
+  defaultForUserId Int?     @map("default_for_user_id")
+  name             String
+  slug             String   @unique
+  introduction     String
+  posts            Post[]   @relation("blog_posts")
+  tags             Tag[]    @relation("blog_tags")
+
+  @@map("blogs")
+}
+
+model Post {
+  id           Int      @id @default(autoincrement())
+  createdAt    DateTime @default(now()) @map("created_at")
+  updatedAt    DateTime @updatedAt @map("updated_at")
+  title        String
+  content      String
+  slug         String   @unique
+  readableSlug String   @map("readable_slug")
+  draft        Boolean?
+  blog         Blog     @relation("blog_posts", fields: [blogId], references: [id])
+  blogId       Int      @map("blog_id")
+  likes        Like[]   @relation("post_likes")
+  likesCount   Int      @default(0) @map("likes_count")
+  cover        String?
+  coverAlt     String?  @map("cover_alt")
+  tags         Tag[]    @relation("post_tags")
+
+  @@map("posts")
+}
+
+model Like {
+  id        Int      @id @default(autoincrement())
+  createdAt DateTime @default(now()) @map("created_at")
+  post      Post     @relation("post_likes", fields: [postId], references: [id])
+  user      User     @relation("user_likes", fields: [userId], references: [id])
+  postId    Int      @map("post_id")
+  userId    Int      @map("user_id")
+
+  @@map("likes")
+}
+
+model Tag {
+  id        Int      @id @default(autoincrement())
+  createdAt DateTime @default(now()) @map("created_at")
+  name      String
+  slug      String
+  blog      Blog     @relation("blog_tags", fields: [blogId], references: [id])
+  blogId    Int      @map("blog_id")
+  posts     Post[]   @relation("post_tags")
+
+  @@map("tags")
+}
```
